<!doctype html>
<html lang="zh-HK">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å·´å£«è½è»Šç¥å™¨ï¼ˆå®‰å…¨å¸¶å°ˆç”¨ï¼‰</title>
  
<section class="topbar">
  <div class="toprow">
    <div class="brand">
      <div class="logo">
        <img src="shitbelt.jpg" alt="å·´å£«è½è»Šç¥å™¨" style="width:100%; height:100%; object-fit:cover; border-radius: inherit;">
      </div>
      <div style="min-width:0">
        <h1>å·´ç›´è½è»Šç¥å™¨ï¼ˆå®‰å…¨å¸¶å°ˆç”¨ï¼‰</h1>
        <div class="sub">
          ææä½ ï¼š<strong>è¨˜å¾—å°‡é›»è©±é–‹åˆ°æœ€å¤§è²</strong>ã€‚
        </div>
      </div>
    </div>
    <button class="mini" id="stopBtn">â›” å³åˆ»æ”¶è²</button>
  </div>
</section>
  <style>
    :root{
      --bg:#0b0f14;
      --stroke:rgba(255,255,255,.10);
      --stroke2:rgba(255,255,255,.14);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.62);

      /* HK transport-ish accents */
      --mtr:#18c37e;
      --kmb:#e60012;
      --taxi:#ffcc00;
      --blue:#2f7cff;

      --shadow: 0 12px 28px rgba(0,0,0,.45);
      --r16:16px;
      --r20:20px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "PingFang TC", "Noto Sans TC", "Microsoft JhengHei", sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 420px at 20% 0%, rgba(24,195,126,.18), transparent 60%),
        radial-gradient(800px 420px at 85% 15%, rgba(230,0,18,.14), transparent 60%),
        radial-gradient(700px 420px at 45% 95%, rgba(47,124,255,.12), transparent 60%),
        var(--bg);
      min-height:100svh;
      display:flex;
      justify-content:center;
      padding:14px;
    }

    .app{ width:min(980px, 100%); }

    /* Top bar */
    .topbar{
      position:sticky; top:0;
      z-index:5;
      background: linear-gradient(180deg, rgba(11,15,20,.92), rgba(11,15,20,.72));
      backdrop-filter: blur(10px);
      border: 1px solid var(--stroke);
      border-radius: var(--r20);
      box-shadow: var(--shadow);
      padding:14px;
      margin-bottom:12px;
    }
    .toprow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      min-width:0;
    }
    .logo{
      width:40px; height:40px;
      border-radius:14px;
      background: linear-gradient(135deg, rgba(24,195,126,.22), rgba(230,0,18,.18));
      border:1px solid var(--stroke2);
      display:grid; place-items:center;
      box-shadow: 0 10px 20px rgba(0,0,0,.35);
      flex:0 0 auto;
      font-size:20px;
    }
    h1{
      margin:0;
      font-size:18px;
      letter-spacing:.2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .sub{
      margin:4px 0 0;
      color:var(--muted);
      font-size:12px;
      line-height:1.35;
    }

    .mini{
      border:1px solid rgba(230,0,18,.45);
      background: rgba(230,0,18,.10);
      color:var(--text);
      border-radius:14px;
      padding:12px 14px;
      cursor:pointer;
      box-shadow: 0 10px 22px rgba(0,0,0,.35);
      font-size:14px;
      transition: transform .05s ease, border-color .15s ease;
      white-space:nowrap;
    }
    .mini:active{ transform: scale(.99); }
    .mini:hover{ border-color: rgba(230,0,18,.62); }

    /* Layout */
    .layout{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    @media (min-width: 880px){
      .layout{ grid-template-columns: 1.15fr .85fr; align-items:start; }
    }

    /* Cards */
    .card{
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.045), rgba(255,255,255,.025));
      border-radius: var(--r20);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding:12px 14px;
      border-bottom:1px solid var(--stroke);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      background: rgba(0,0,0,.10);
    }
    .hdTitle{
      font-size:14px;
      color: rgba(255,255,255,.88);
      display:flex;
      align-items:center;
      gap:10px;
      margin:0;
    }
    .tag{
      font-size:12px;
      color:rgba(255,255,255,.75);
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      padding:6px 10px;
      border-radius: 999px;
      user-select:none;
      white-space:nowrap;
    }
    .card .bd{ padding:12px; }

    /* Buttons grid */
    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    @media (min-width: 560px){
      .grid{ grid-template-columns: 1fr 1fr; }
    }

    .speakBtn{
      width:100%;
      text-align:left;
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(11,18,32,.92), rgba(11,18,32,.72));
      border-radius: var(--r16);
      padding:14px 14px 12px;
      cursor:pointer;
      box-shadow: 0 10px 22px rgba(0,0,0,.38);
      display:flex;
      gap:12px;
      align-items:flex-start;
      transition: transform .05s ease, border-color .15s ease, background .15s ease;
      min-height:96px;
    }
    .speakBtn:active{ transform: scale(.99); }
    .speakBtn:hover{ border-color: rgba(255,255,255,.18); }

    .badgeIcon{
      width:44px; height:44px;
      border-radius: 14px;
      border:1px solid var(--stroke2);
      display:grid; place-items:center;
      background: rgba(255,255,255,.06);
      flex: 0 0 auto;
      font-size:20px;
    }
    .badgeIcon.kmb{ background: rgba(230,0,18,.10); border-color: rgba(230,0,18,.35); }
    .badgeIcon.taxi{ background: rgba(255,204,0,.10); border-color: rgba(255,204,0,.35); }
    .badgeIcon.mtr{ background: rgba(24,195,126,.14); border-color: rgba(24,195,126,.35); }
    .badgeIcon.blue{ background: rgba(47,124,255,.10); border-color: rgba(47,124,255,.35); }

    .meta{ flex:1 1 auto; min-width:0; }
    .titleRow{
      display:flex;
      align-items:center;
      gap:10px;
      margin-bottom:6px;
    }
    .scenario{
      font-weight:800;
      letter-spacing:.3px;
      font-size:14px;
      color: rgba(255,255,255,.92);
      padding:4px 10px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      user-select:none;
      white-space:nowrap;
    }
    .phrase{
      font-size:16px;
      line-height:1.25;
      letter-spacing:.2px;
      color: rgba(255,255,255,.92);
      overflow-wrap:anywhere;
    }
    .small{
      margin-top:10px;
      color: var(--muted);
      font-size:12px;
      line-height:1.45;
    }

    /* Composer */
    textarea{
      width:100%;
      resize: none;
      height:120px;
      border-radius: 16px;
      padding:12px 12px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.25);
      color: var(--text);
      outline: none;
      font-size:15px;
      line-height:1.35;
    }
    textarea::placeholder{ color: rgba(255,255,255,.40); }

    .composerActions{
      display:flex;
      gap:10px;
      margin-top:10px;
      flex-wrap:wrap;
    }
    .btn{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      color:var(--text);
      border-radius:14px;
      padding:12px 14px;
      cursor:pointer;
      box-shadow: 0 10px 22px rgba(0,0,0,.35);
      font-size:14px;
      transition: transform .05s ease, border-color .15s ease;
      white-space:nowrap;
    }
    .btn:active{ transform: scale(.99); }
    .btn:hover{ border-color: rgba(255,255,255,.18); }
    .btn.primary{
      border:1px solid rgba(24,195,126,.45);
      background: rgba(24,195,126,.14);
    }
    .btn.danger{
      border:1px solid rgba(230,0,18,.45);
      background: rgba(230,0,18,.10);
    }

    /* Bottom hint */
    .bottombar{
      margin-top:12px;
      border:1px dashed rgba(255,255,255,.16);
      border-radius: 16px;
      padding:10px 12px;
      color: rgba(255,255,255,.70);
      font-size:12px;
      line-height:1.35;
      background: rgba(0,0,0,.14);
    }
    .kbd{
      display:inline-block;
      padding:2px 8px;
      border:1px solid rgba(255,255,255,.18);
      border-bottom-color: rgba(255,255,255,.28);
      border-radius: 8px;
      background: rgba(255,255,255,.06);
      font-size:12px;
      color: rgba(255,255,255,.85);
      margin:0 2px;
    }
  </style>
</head>

<body>
  <div class="app">

    <section class="topbar">
      <div class="toprow">
        <div class="brand">
          <div class="logo">ğŸš</div>
          <div style="min-width:0">
            <h1>å·´ç›´è½è»Šç¥å™¨ï¼ˆå®‰å…¨å¸¶å°ˆç”¨ï¼‰</h1>
            <div class="sub">
              ææä½ ï¼š<strong>è¨˜å¾—å°‡é›»è©±é–‹åˆ°æœ€å¤§è²</strong>ã€‚
            </div>
          </div>
        </div>

        <!-- Stop button pinned to far right -->
        <button class="mini" id="stopBtn">â›” å³åˆ»æ”¶è²</button>
      </div>
    </section>

    <section class="layout">

      <!-- Left: buttons -->
      <div class="card">
        <div class="hd">
          <p class="hdTitle">ğŸ“ ä¸€æ’³å³æ’­</p>
          <span class="tag" id="countTag">0</span>
        </div>
        <div class="bd">
          <div class="grid" id="buttonGrid"></div>
          <div class="bottombar">
            å°æŠ€å·§ï¼šæ¡Œé¢ç‰ˆå¯æŒ‰ <span class="kbd">Space</span> å³åˆ»åœï¼›è¼¸å…¥æ¡†ï¼š<span class="kbd">Enter</span> å³æ’­ã€<span class="kbd">Ctrl/âŒ˜</span> + <span class="kbd">Enter</span> åŠ å…¥æ¸…å–®ã€‚
          </div>
        </div>
      </div>

      <!-- Right: user input -->
      <div class="card">
        <div class="hd">
          <p class="hdTitle">âœï¸ è‡ªå·±å…¥ä¸€å¥</p>
          <span class="tag">è‡ªè¨‚</span>
        </div>
        <div class="bd">
          <textarea id="customInput" placeholder="ä¾‹å¦‚ï¼šå¸æ©Ÿå””è©²ç­‰ä¸€ç­‰ï¼æˆ‘æ¢å®‰å…¨å¸¶å¡ä½å‘€ï¼"></textarea>

          <div class="composerActions">
            <button class="btn primary" id="speakNowBtn">ğŸ”Š å³åˆ»æ’­</button>
            <button class="btn primary" id="addBtn">â• åŠ å…¥æ¸…å–®</button>
            <button class="btn danger" id="clearBtn">ğŸ§¹ æ¸…é™¤è‡ªè¨‚</button>
          </div>

          <div class="small">
            âœ… è‡ªè¨‚å¥å­æœƒå„²å–ºæœ¬æ©Ÿï¼ˆlocalStorageï¼‰ï¼Œä¸‹æ¬¡é–‹è¿”åŒä¸€æ¢ link ä»ç„¶æœƒå–ºåº¦ã€‚
          </div>
        </div>
      </div>

    </section>

  </div>

<script>
  // ===== Default phrases (preset) =====
  const DEFAULT_ITEMS = [
    {
      label: "å¡å®‰å…¨å¸¶",
      icon: "ğŸšª",
      cls: "kmb",
      text: "æˆ‘ä¿¾æ¢å®‰å…¨å¸¶kickä½å’—ï¼Œå¸æ©Ÿç­‰åŸ‹æˆ‘è½è»Šå…ˆé–‚é–€å–ï¼Œå””è©²æ™’ï¼"
    },
    {
      label: "é¬†å””é–‹",
      icon: "ğŸ†˜",
      cls: "kmb",
      text: "å¸æ©Ÿå¤§å“¥ï¼Œæ¢å®‰å…¨å¸¶é¬†å””é–‹å‘€ï¼Œæ•‘æˆ‘ï¼"
    },
    {
      label: "å””è©²èµ·èº«",
      icon: "âœ‹",
      cls: "taxi",
      text: "éš”é›¢å‘¢ä½ä¹˜å®¢ä½ å¥½ï¼Œå› ç‚ºæˆ‘è¦è½è»Šï¼Œä½†åˆå› ç‚ºä½ åå’—å–ºåº¦æˆ‘è¡Œå””åˆ°å‡ºå»ï¼Œéº»ç…©ä½ å…ˆé¬†ä¸€é¬†å®‰å…¨å¸¶æ¯”æˆ‘è½è»Šå…ˆå–ï¼æ±‚ä¸‹ä½ ï¼"
    },
    {
      label: "å””å¥½é–‚é–€",
      icon: "âš ï¸",
      cls: "taxi",
      text: "å””å¥½é–‚é–€ä½ï¼æˆ‘éš”é›¢å—°å€‹æœªé¬†åˆ°æ¢å®‰å…¨å¸¶æ¯”æˆ‘è½è»Šå‘€ï¼"
    },
    {
      label: "æ’³å””åˆ°é˜",
      icon: "ğŸ””",
      cls: "mtr",
      text: "å¸æ©Ÿæˆ‘ä¸‹ç«™æœ‰è½ï¼Œä½†æˆ‘æ¯”æ¢å®‰å…¨å¸¶coolä½å’—ï¼Œæ’³å””åˆ°è½è»Šé˜å‘€ï¼"
    }
  ];

  // ===== UI refs =====
  const grid = document.getElementById("buttonGrid");
  const countTag = document.getElementById("countTag");
  const stopBtn = document.getElementById("stopBtn");
  const customInput = document.getElementById("customInput");
  const speakNowBtn = document.getElementById("speakNowBtn");
  const addBtn = document.getElementById("addBtn");
  const clearBtn = document.getElementById("clearBtn");

  // ===== Storage =====
  const STORAGE_KEY = "hk_fun_canto_phrases_v2";
  function loadCustomPhrases(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      const arr = raw ? JSON.parse(raw) : [];
      return Array.isArray(arr) ? arr.filter(s => typeof s === "string" && s.trim()) : [];
    }catch(e){
      return [];
    }
  }
  function saveCustomPhrases(arr){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
  }

  // ===== Speech setup =====
  let selectedVoice = null;

  function pickBestVoice(){
    if (!("speechSynthesis" in window)) return;
    const voices = window.speechSynthesis.getVoices() || [];
    if (!voices.length){ selectedVoice = null; return; }

    const scored = voices.map(v => {
      const name = (v.name || "").toLowerCase();
      const lang = (v.lang || "").toLowerCase();
      let score = 0;
      if (lang === "zh-hk") score += 100;
      if (lang.startsWith("yue")) score += 95;
      if (name.includes("cantonese")) score += 100;
      if (name.includes("hong kong") || name.includes("hongkong")) score += 40;
      if (lang.startsWith("zh")) score += 18;
      if (v.localService) score += 5;
      return { v, score };
    }).sort((a,b) => b.score - a.score);

    selectedVoice = scored[0]?.v || null;
  }

  if ("speechSynthesis" in window){
    window.speechSynthesis.onvoiceschanged = pickBestVoice;
    pickBestVoice();
  }

  function stopSpeaking(){
    try{ window.speechSynthesis.cancel(); }catch(e){}
  }

  function speak(text){
    if (!("speechSynthesis" in window)) return;
    const t = (text || "").trim();
    if (!t) return;

    stopSpeaking();

    const u = new SpeechSynthesisUtterance(t);
    u.lang = "zh-HK";
    if (selectedVoice) u.voice = selectedVoice;

    u.volume = 1.0;
    u.rate = 0.95;
    u.pitch = 1.0;

    setTimeout(() => window.speechSynthesis.speak(u), 60);
  }

  // ===== Render =====
  function escapeHtml(str){
    return str.replace(/[&<>"']/g, m => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
    }[m]));
  }

  function makeButton({label, icon, cls, text}){
    const btn = document.createElement("button");
    btn.type = "button";
    btn.className = "speakBtn";
    btn.innerHTML = `
      <div class="badgeIcon ${cls}">${icon}</div>
      <div class="meta">
        <div class="titleRow">
          <div class="scenario">${escapeHtml(label)}</div>
        </div>
        <div class="phrase">${escapeHtml(text)}</div>
      </div>
    `;
    btn.addEventListener("click", () => speak(text));
    return btn;
  }

  function render(){
    grid.innerHTML = "";

    const custom = loadCustomPhrases().map((t, i) => ({
      label: "è‡ªè¨‚",
      icon: "ğŸ“£",
      cls: "blue",
      text: t
    }));

    const all = [...DEFAULT_ITEMS, ...custom];
    all.forEach(item => grid.appendChild(makeButton(item)));

    countTag.textContent = String(all.length);
  }

  // ===== Events =====
  stopBtn.addEventListener("click", stopSpeaking);

  window.addEventListener("keydown", (e) => {
    if (e.code === "Space") {
      e.preventDefault();
      stopSpeaking();
    }
  });

  speakNowBtn.addEventListener("click", () => speak(customInput.value));

  addBtn.addEventListener("click", () => {
    const t = (customInput.value || "").trim();
    if (!t) { customInput.focus(); return; }

    const custom = loadCustomPhrases();
    if (!custom.includes(t)) {
      custom.unshift(t);
      saveCustomPhrases(custom.slice(0, 30));
    }

    customInput.value = "";
    render();
    speak(t);
  });

  clearBtn.addEventListener("click", () => {
    localStorage.removeItem(STORAGE_KEY);
    render();
    stopSpeaking();
  });

  // Enter to speak, Ctrl/âŒ˜+Enter to add
  customInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      if (e.ctrlKey || e.metaKey) addBtn.click();
      else speakNowBtn.click();
    }
  });

  render();
</script>
</body>
</html>
